#!/bin/bash

echo "ðŸš€ LMS ì‹œìŠ¤í…œ ì‹œìž‘"
echo "=================="

# í™˜ê²½ ì„¤ì • íŒŒì¼ ë³µì‚¬
if [ ! -f .env ]; then
    echo "ðŸ“ í™˜ê²½ ì„¤ì • íŒŒì¼ ìƒì„± ì¤‘..."
    cp .env.example .env
    echo "âœ… .env íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. í•„ìš”ì‹œ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •ì„ ìˆ˜ì •í•˜ì„¸ìš”."
fi

# ë°±ì—”ë“œ ì˜ì¡´ì„± ì„¤ì¹˜
echo "ðŸ“¦ ë°±ì—”ë“œ ì˜ì¡´ì„± ì„¤ì¹˜ ì¤‘..."
npm install

# í”„ë¡ íŠ¸ì—”ë“œ ì˜ì¡´ì„± ì„¤ì¹˜
echo "ðŸ“¦ í”„ë¡ íŠ¸ì—”ë“œ ì˜ì¡´ì„± ì„¤ì¹˜ ì¤‘..."
cd frontend
npm install
cd ..

# ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸
echo "ðŸ—ƒï¸  ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸..."
echo "PostgreSQLì´ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”."
echo "ê¸°ë³¸ ì„¤ì •: localhost:5432/lms"

# ë°±ì—”ë“œ ì„œë²„ ì‹œìž‘ (ë°±ê·¸ë¼ìš´ë“œ)
echo "ðŸ–¥ï¸  ë°±ì—”ë“œ ì„œë²„ ì‹œìž‘ ì¤‘..."
npm run dev &
BACKEND_PID=$!

# ìž ì‹œ ëŒ€ê¸°
sleep 3

# í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ì‹œìž‘ (ë°±ê·¸ë¼ìš´ë“œ)
echo "ðŸŒ í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ì‹œìž‘ ì¤‘..."
cd frontend
npm start &
FRONTEND_PID=$!
cd ..

echo ""
echo "âœ… LMS ì‹œìŠ¤í…œì´ ì‹œìž‘ë˜ì—ˆìŠµë‹ˆë‹¤!"
echo ""
echo "ðŸ“ ì ‘ì† ì£¼ì†Œ:"
echo "   - ì›¹ì‚¬ì´íŠ¸: http://localhost:3001"
echo "   - API ì„œë²„: http://localhost:3000"
echo ""
echo "âš¡ ì„œë²„ ìƒíƒœ í™•ì¸:"
echo "   - ë°±ì—”ë“œ PID: $BACKEND_PID"
echo "   - í”„ë¡ íŠ¸ì—”ë“œ PID: $FRONTEND_PID"
echo ""
echo "ðŸ›‘ ì„œë²„ ì¤‘ì§€: Ctrl+C ë˜ëŠ” ./stop.sh"
echo ""

# ì‚¬ìš©ìžê°€ Ctrl+Cë¥¼ ëˆ„ë¥¼ ë•Œê¹Œì§€ ëŒ€ê¸°
trap "echo 'ðŸ›‘ ì„œë²„ë¥¼ ì¤‘ì§€í•©ë‹ˆë‹¤...'; kill $BACKEND_PID $FRONTEND_PID 2>/dev/null; exit" INT

wait